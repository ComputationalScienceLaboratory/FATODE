MODULE cbm4_Parameters
    INTEGER, PARAMETER :: NVAR = 32
    INTEGER, PARAMETER :: NNZ = 19
    INTEGER, PARAMETER :: NREACT=81, NFIX=1
    ! RCONST - Rate constants (local)
    DOUBLE PRECISION :: RCONST(NREACT)
   ! FIX - Concentrations of fixed species 
    DOUBLE PRECISION :: FIX(NFIX)
    DOUBLE PRECISION :: SUN
    ! Temperature
    DOUBLE PRECISION :: TEMP
! Row-compressed sparse data for the Jacobian of reaction products JVRP

    INTEGER, PARAMETER, DIMENSION(82) :: CROW_JVRP = (/ &
       1,  2,  3,  5,  7,  9, 11, 13, 14, 15, 16, 17, &
      19, 21, 22, 24, 26, 28, 29, 30, 31, 33, 35, 36, &
      38, 39, 41, 43, 45, 47, 48, 50, 51, 52, 53, 55, &
      57, 59, 60, 61, 63, 65, 67, 69, 71, 72, 74, 76, &
      77, 78, 80, 81, 83, 84, 85, 87, 89, 91, 93, 95, &
      97, 99,101,103,105,106,108,110,112,114,116,117, &
     119,121,122,124,126,128,130,132,133,135 /)

    INTEGER, PARAMETER, DIMENSION(134) :: ICOL_JVRP = (/ &
      26, 29, 25, 31, 26, 29, 26, 29, 29, 31, 25, 26, &
      25, 25,  1,  1, 25, 27, 25, 28, 30, 30, 31, 26, &
      30, 26, 30,  6,  6, 31, 26, 31, 27, 31,  9,  9, &
      27,  9, 26, 27, 12, 27, 28, 31, 26, 28, 10, 10, &
      27, 28, 28,  2,  2, 27, 16, 27, 21, 27, 21, 21, &
      21, 29, 21, 30, 24, 29, 24, 27, 24, 30, 24, 31, &
      32, 26, 32,  3, 32, 28, 32, 27, 20, 27, 13, 13, &
      13, 26, 23, 29, 23, 27, 23, 25, 23, 30, 17, 29, &
      17, 27, 17, 25,  5, 27, 11, 31, 11, 14, 27, 14, &
      30,  4, 26,  7, 27, 19, 27, 19, 19, 25, 15, 27, &
      15, 22, 29, 22, 27, 22, 25, 22, 30, 18, 31, 18, &
       8, 31 /)
!  Stoichiometric Matrix in Compressed Column Sparse Format


    INTEGER, PARAMETER, DIMENSION(82) :: CCOL_STOICM = (/ &
       1,  4,  6,  9, 12, 15, 18, 21, 23, 25, 27, 29, &
      32, 35, 39, 42, 44, 47, 49, 52, 54, 57, 60, 63, &
      66, 69, 72, 75, 79, 82, 85, 88, 90, 92, 94, 97, &
     100,104,107,109,114,119,123,126,130,135,141,144, &
     147,151,156,160,167,173,175,177,187,194,203,211, &
     218,224,229,235,240,243,249,253,255,263,270,274, &
     284,288,292,301,311,321,324,327,328,330 /)

    INTEGER, PARAMETER, DIMENSION(329) :: IROW_STOICM = (/ &
      26, 29, 31, 25, 29, 25, 26, 31, 26, 29, 31, 26, &
      29, 30, 26, 29, 31, 25, 26, 30, 25, 29,  1, 25, &
       1, 29,  1, 27, 25, 27, 28, 25, 27, 28, 26, 29, &
      30, 31, 26, 30, 31, 30, 31,  6, 26, 30,  6, 12, &
       6, 26, 30, 26, 31,  9, 26, 31,  9, 27, 31,  9, &
      27, 31,  9, 26, 27,  9, 26, 31, 12, 26, 27, 12, &
      27, 30, 26, 27, 28, 31, 10, 26, 28, 10, 26, 28, &
      10, 26, 27,  2, 28,  2, 28,  2, 27,  2, 27, 28, &
      16, 27, 28, 16, 21, 27, 28, 16, 21, 28, 16, 21, &
      16, 21, 27, 28, 29, 12, 16, 21, 28, 30, 24, 27, &
      29, 32, 24, 27, 32, 12, 24, 30, 32, 16, 18, 21, &
      24, 28, 18, 21, 26, 28, 31, 32,  3, 26, 32,  3, &
      26, 32, 18, 21, 28, 32, 18, 21, 27, 28, 32, 18, &
      21, 27, 28,  8, 13, 18, 20, 24, 27, 28,  8, 13, &
      18, 20, 24, 28, 13, 28, 13, 26,  8, 16, 18, 20, &
      21, 23, 24, 27, 28, 29, 18, 20, 21, 23, 24, 27, &
      28, 16, 18, 20, 21, 23, 24, 25, 27, 28,  8, 18, &
      20, 21, 23, 24, 26, 30, 16, 17, 18, 21, 27, 28, &
      29, 17, 18, 21, 24, 27, 28, 16, 17, 21, 25, 28, &
       5, 11, 14, 18, 27, 28, 11, 19, 26, 28, 31, 11, &
      14, 28,  4, 14, 18, 19, 27, 28,  4, 12, 14, 30, &
       4, 26,  7, 11, 14, 15, 18, 20, 27, 28, 16, 18, &
      19, 21, 27, 28, 32, 16, 19, 28, 32, 15, 16, 18, &
      19, 21, 24, 25, 27, 28, 32, 15, 18, 27, 32, 15, &
      16, 28, 32, 16, 17, 18, 20, 22, 23, 24, 28, 29, &
       8, 15, 17, 18, 21, 22, 24, 27, 28, 32, 15, 16, &
      17, 20, 21, 22, 24, 25, 27, 28,  8, 22, 30, 18, &
      26, 31, 18,  8, 31 /)

    INTEGER, PARAMETER, DIMENSION(329) :: ICOL_STOICM = (/ &
       1,  1,  1,  2,  2,  3,  3,  3,  4,  4,  4,  5, &
       5,  5,  6,  6,  6,  7,  7,  7,  8,  8,  9,  9, &
      10, 10, 11, 11, 12, 12, 12, 13, 13, 13, 14, 14, &
      14, 14, 15, 15, 15, 16, 16, 17, 17, 17, 18, 18, &
      19, 19, 19, 20, 20, 21, 21, 21, 22, 22, 22, 23, &
      23, 23, 24, 24, 24, 25, 25, 25, 26, 26, 26, 27, &
      27, 27, 28, 28, 28, 28, 29, 29, 29, 30, 30, 30, &
      31, 31, 31, 32, 32, 33, 33, 34, 34, 35, 35, 35, &
      36, 36, 36, 37, 37, 37, 37, 38, 38, 38, 39, 39, &
      40, 40, 40, 40, 40, 41, 41, 41, 41, 41, 42, 42, &
      42, 42, 43, 43, 43, 44, 44, 44, 44, 45, 45, 45, &
      45, 45, 46, 46, 46, 46, 46, 46, 47, 47, 47, 48, &
      48, 48, 49, 49, 49, 49, 50, 50, 50, 50, 50, 51, &
      51, 51, 51, 52, 52, 52, 52, 52, 52, 52, 53, 53, &
      53, 53, 53, 53, 54, 54, 55, 55, 56, 56, 56, 56, &
      56, 56, 56, 56, 56, 56, 57, 57, 57, 57, 57, 57, &
      57, 58, 58, 58, 58, 58, 58, 58, 58, 58, 59, 59, &
      59, 59, 59, 59, 59, 59, 60, 60, 60, 60, 60, 60, &
      60, 61, 61, 61, 61, 61, 61, 62, 62, 62, 62, 62, &
      63, 63, 63, 63, 63, 63, 64, 64, 64, 64, 64, 65, &
      65, 65, 66, 66, 66, 66, 66, 66, 67, 67, 67, 67, &
      68, 68, 69, 69, 69, 69, 69, 69, 69, 69, 70, 70, &
      70, 70, 70, 70, 70, 71, 71, 71, 71, 72, 72, 72, &
      72, 72, 72, 72, 72, 72, 72, 73, 73, 73, 73, 74, &
      74, 74, 74, 75, 75, 75, 75, 75, 75, 75, 75, 75, &
      76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 77, 77, &
      77, 77, 77, 77, 77, 77, 77, 77, 78, 78, 78, 79, &
      79, 79, 80, 81, 81 /)

    DOUBLE PRECISION, PARAMETER, DIMENSION(150) :: STOICM_0 = (/ &
      -1.000000e+00,  1.000000e+00,  1.000000e+00,  1.000000e+00, -1.000000e+00, &
      -1.000000e+00,  1.000000e+00,  -1.000000e+00,  -1.000000e+00, -1.000000e+00, &
      1.000000e+00,  -1.000000e+00,  -1.000000e+00,  1.000000e+00, 1.000000e+00, &
      -1.000000e+00,  -1.000000e+00,  -1.000000e+00, -1.000000e+00,  1.000000e+00, &
      -1.000000e+00,  1.000000e+00,  1.000000e+00,  -1.000000e+00, -1.000000e+00, &
       1.000000e+00,  -1.000000e+00,  2.000000e+00,  -1.000000e+00, -1.000000e+00, &
       1.000000e+00,  -1.000000e+00,  1.000000e+00,  -1.000000e+00, 8.900000e-01, &
       8.900000e-01,  -1.000000e+00,  1.100000e-01,  2.000000e+00, -1.000000e+00, &
       -1.000000e+00,  -1.000000e+00,  1.000000e+00,  1.000000e+00, -1.000000e+00, &
       -1.000000e+00,  -1.000000e+00,  2.000000e+00,  -1.000000e+00, 1.000000e+00, &
       1.000000e+00,  2.000000e+00,  -2.000000e+00,  2.000000e+00, -1.000000e+00, &
       -1.000000e+00,  1.000000e+00,  -1.000000e+00,  -1.000000e+00, -1.000000e+00, &
       1.000000e+00,  1.000000e+00,  -1.000000e+00,  1.000000e+00, -1.000000e+00, &
       -2.000000e+00,  1.000000e+00,  1.000000e+00,  1.000000e+00, -1.000000e+00, &
       -1.000000e+00,  -1.000000e+00,  -1.000000e+00,  1.000000e+00, 1.000000e+00, &
       1.000000e+00,  -1.000000e+00,  -1.000000e+00,  1.000000e+00, -1.000000e+00, &
       -1.000000e+00,  -1.000000e+00,  1.000000e+00,  1.000000e+00, -1.000000e+00, &
       1.000000e+00,  -1.000000e+00,  1.000000e+00,  -2.000000e+00, 1.000000e+00, &
       -2.000000e+00,  -1.000000e+00,  2.000000e+00,  -1.000000e+00, -1.000000e+00, &
       1.000000e+00,  -1.000000e+00,  -1.000000e+00,  1.000000e+00, 1.000000e+00, &
       -1.000000e+00,  -1.000000e+00,  1.000000e+00,  1.000000e+00, -1.000000e+00, &
       2.000000e+00,  1.000000e+00,  -1.000000e+00,  1.000000e+00, -1.000000e+00, &
       1.000000e+00,  1.000000e+00,  -1.000000e+00,  1.000000e+00, 1.000000e+00, &
       -1.000000e+00,  1.000000e+00,  -1.000000e+00,  -1.000000e+00, 1.000000e+00, &
       -1.000000e+00,  1.000000e+00,  -1.000000e+00,  -1.000000e+00, 1.000000e+00, &
       1.000000e+00,  -1.000000e+00,  -1.000000e+00,  1.000000e+00, 1.000000e+00, &
       1.000000e+00,  1.000000e+00,  -1.000000e+00,  2.000000e+00, 1.000000e+00, &
       1.000000e+00,  1.000000e+00,  1.000000e+00,  -1.000000e+00, -1.000000e+00, &
       1.000000e+00,  -1.000000e+00,  -1.000000e+00,  -1.000000e+00, 1.000000e+00, &
       1.000000e+00,  2.000000e+00,  2.000000e+00,  2.000000e+00, -2.000000e+00 /)


     DOUBLE PRECISION, PARAMETER, DIMENSION(150) :: STOICM_1 = (/ &
       7.900000e-01,  7.900000e-01,  7.900000e-01,  -2.100000e-01, -1.000000e+00, &
       1.000000e+00,  1.000000e+00,  -1.000000e+00,  1.000000e+00, 1.300000e-01, &
       7.600000e-01,  8.700000e-01,  -1.110000e+00,  1.100000e-01, -1.000000e+00, &
       1.100000e-01,  4.000000e-02,  -9.800000e-01,  9.600000e-01, -2.100000e+00, &
       1.100000e+00,  9.400000e-01,  -1.000000e+00,  1.000000e+00, -1.000000e+00, &
       -1.000000e+00,  2.000000e-02,  3.000000e-01,  2.800000e-01, 2.200000e-01, &
       2.000000e-01,  -1.000000e+00,  6.300000e-01,  2.000000e-01, 3.800000e-01, &
       -1.000000e+00,  1.000000e+00,  -1.000000e+00,  1.000000e+00, -1.000000e+00, &
       1.000000e+00,  -1.000000e+00,  1.000000e+00,  3.300000e-01, 2.200000e-01, &
       -1.000000e+00,  7.400000e-01,  -1.000000e+00,  5.000000e-01, -1.000000e+00, &
       1.000000e-01,  4.400000e-01,  9.000000e-02,  9.100000e-01, -1.000000e+00, &
       1.000000e+00,  -1.000000e+00,  1.000000e+00,  1.000000e+00, -1.000000e+00, &
       1.000000e+00,  -1.000000e+00,  7.000000e-01,  1.000000e+00, 3.000000e-01, &
       1.700000e+00,  -1.000000e+00,  -1.000000e+00,  1.000000e+00, 1.560000e+00, &
       2.200000e-01,  -1.000000e+00,  1.000000e+00,  4.200000e-01, -1.000000e+00, &
       1.000000e+00,  -1.000000e+00,  1.200000e-01,  -1.000000e+00, 5.600000e-01, &
       3.600000e-01,  8.000000e-02,  -1.000000e+00,  4.400000e-01, -1.000000e+00, &
       9.000000e-01,  9.000000e-01,  9.000000e-01,  -1.000000e+00, -1.000000e+00, &
       1.000000e+00,  1.000000e+00,  4.000000e-01,  -1.000000e+00, 6.000000e-01, &
       3.000000e-01,  -1.000000e+00,  6.000000e-01,  1.000000e+00, 1.000000e+00, &
       -1.000000e+00,  -1.000000e+00,  -1.000000e+00, -1.000000e+00,  -1.000000e+00, &
       3.000000e-01,  2.000000e-01,  8.000000e-01,  5.000000e-01, 1.100000e+00, &
       -1.000000e+00,  7.000000e-01,  2.000000e+00,  1.000000e+00, -1.000000e+00, &
       1.000000e+00,  -1.000000e+00,  2.000000e+00,  1.000000e+00, 1.000000e+00, &
       -1.000000e+00,  1.000000e+00,  1.000000e+00,  2.000000e-01, 6.900000e-01, &
       3.000000e-02,  -1.000000e+00,  7.000000e-01,  3.000000e-02, -1.000000e+00, &
       8.000000e-02,  7.600000e-01,  6.200000e-01,  -1.000000e+00, 1.000000e+00, &
       -1.000000e+00,  1.000000e+00,  -1.000000e+00,  1.000000e+00, 1.000000e+00, &
       1.000000e+00,  5.000000e-01,  4.500000e-01,  5.000000e-01, 9.000000e-01, &
       -1.000000e+00,  5.500000e-01,  8.000000e-01,  6.000000e-01, -1.000000e+00 /)

     DOUBLE PRECISION, PARAMETER, DIMENSION(29) :: STOICM_2 = (/ &
       1.300000e-01,  4.000000e-01,  1.000000e+00,  1.000000e+00, 1.000000e+00, &
       -1.000000e+00,  2.000000e-01,  -1.000000e+00,  6.700000e-01, 2.000000e-01, &
       2.000000e-01,  6.000000e-02,  5.500000e-01,  1.000000e-01, 1.000000e+00, &
       -1.000000e+00,  4.000000e-01,  -1.000000e+00,  1.000000e-01, 4.400000e-01, &
       1.000000e+00,  -1.000000e+00,  -1.000000e+00,  -1.000000e+00, 1.000000e+00, &
       -1.000000e+00,  -2.000000e+00,  -1.000000e+00,  -1.000000e+00 /)

     DOUBLE PRECISION, PARAMETER, DIMENSION(329) :: STOICM = (/ STOICM_0, STOICM_1, STOICM_2 /)

CONTAINS
    ! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    ! 
    ! Update_SUN - update SUN light using TIME
    !   Arguments :
    ! 
    ! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    SUBROUTINE Update_SUN(T)
    IMPLICIT NONE

    DOUBLE PRECISION :: T, SunRise, SunSet
    DOUBLE PRECISION :: Thour, Tlocal, Ttmp
    ! PI - Value of pi
    DOUBLE PRECISION, PARAMETER :: PI = 3.14159265358979d0
    SunRise = 4.5d0
    SunSet  = 19.5d0
    Thour = T/3600.0d0
    Tlocal = Thour - (INT(Thour)/24)*24

    IF ((Tlocal>=SunRise).AND.(Tlocal<=SunSet)) THEN
       Ttmp = (2.0*Tlocal - SunRise - SunSet) / (SunSet - SunRise)
       IF (Ttmp.GT.0) THEN
          Ttmp =  Ttmp*Ttmp
       ELSE
          Ttmp = -Ttmp*Ttmp
       END IF
       SUN = ( 1.0d0 + COS(PI*Ttmp) )/2.0d0
    ELSE
       SUN = 0.0d0
    END IF

    END SUBROUTINE Update_SUN
    ! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    ! 
    ! Update_RCONST - function to update rate constants
    !   Arguments :
    ! 
    ! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    SUBROUTINE Update_RCONST ( )
    RCONST(1) = (8.89D-3*SUN)
    RCONST(2) = (ARR2(1.4D+3,1175.0D0))
    RCONST(3) = (ARR2(1.8D-12,-1370.0D0))
    ! RCONST(4) = constant rate coefficient
    RCONST(5) = (ARR2(1.6D-13,687.0D0))
    RCONST(6) = (ARR2(2.2D-13,602.0D0))
    RCONST(7) = (ARR2(1.2D-13,-2450.0D0))
    RCONST(8) = (3.556D-04*SUN)
    RCONST(9) = (2.489D-05*SUN)
    RCONST(10) = (ARR2(1.9D+8,390.0D0))
    ! RCONST(11) = constant rate coefficient
    RCONST(12) = (ARR2(1.6D-12,-940.0D0))
    RCONST(13) = (ARR2(1.4D-14,-580.0D0))
    RCONST(14) = (1.378D-01*SUN)
    RCONST(15) = (ARR2(1.3D-11,250.0D0))
    RCONST(16) = (ARR2(2.5D-14,-1230.0D0))
    RCONST(17) = (ARR2(5.3D-13,256.0D0))
    ! RCONST(18) = constant rate coefficient
    RCONST(19) = (ARR2(3.5D+14,-10897.0D0))
    RCONST(20) = (ARR2(1.8D-20,530.0D0))
    ! RCONST(21) = constant rate coefficient
    RCONST(22) = (ARR2(4.5D-13,806.0D0))
    RCONST(23) = (1.511D-03*SUN)
    ! RCONST(24) = constant rate coefficient
    ! RCONST(25) = constant rate coefficient
    RCONST(26) = (ARR2(1.0D-12,713.0D0))
    RCONST(27) = (ARR2(5.1D-15,1000.0D0))
    RCONST(28) = (ARR2(3.7D-12,240.0D0))
    RCONST(29) = (ARR2(1.2D-13,749.0D0))
    RCONST(30) = (ARR2(4.8D+13,-10121.0D0))
    RCONST(31) = (ARR2(1.3D-12,380.0D0))
    RCONST(32) = (ARR2(5.9D-14,1150.0D0))
    RCONST(33) = (ARR2(2.2D-38,5800.0D0))
    RCONST(34) = (6.312D-06*SUN)
    RCONST(35) = (ARR2(3.1D-12,-187.0D0))
    ! RCONST(36) = constant rate coefficient
    ! RCONST(37) = constant rate coefficient
    RCONST(38) = (2.845D-05*SUN)
    RCONST(39) = (3.734D-05*SUN)
    RCONST(40) = (ARR2(3.0D-11,-1550.0D0))
    ! RCONST(41) = constant rate coefficient
    RCONST(42) = (ARR2(1.2D-11,-986.0D0))
    RCONST(43) = (ARR2(7.0D-12,250.0D0))
    ! RCONST(44) = constant rate coefficient
    RCONST(45) = (4.00D-06*SUN)
    RCONST(46) = (ARR2(5.4D-12,250.0D0))
    RCONST(47) = (ARR2(8.0D-20,5500.0D0))
    RCONST(48) = (ARR2(9.4D+16,-14000.0D0))
    ! RCONST(49) = constant rate coefficient
    ! RCONST(50) = constant rate coefficient
    RCONST(51) = (ARR2(1.1D+2,-1710.0D0))
    ! RCONST(52) = constant rate coefficient
    RCONST(53) = (ARR2(1.0D+15,-8000.0D0))
    ! RCONST(54) = constant rate coefficient
    ! RCONST(55) = constant rate coefficient
    RCONST(56) = (ARR2(1.2D-11,-324.0D0))
    RCONST(57) = (ARR2(5.2D-12,504.0D0))
    RCONST(58) = (ARR2(1.4D-14,-2105.0D0))
    ! RCONST(59) = constant rate coefficient
    RCONST(60) = (ARR2(1.0D-11,-792.0D0))
    RCONST(61) = (ARR2(2.0D-12,411.0D0))
    RCONST(62) = (ARR2(1.3D-14,-2633.0D0))
    RCONST(63) = (ARR2(2.1D-12,322.0D0))
    ! RCONST(64) = constant rate coefficient
    ! RCONST(65) = constant rate coefficient
    ! RCONST(66) = constant rate coefficient
    ! RCONST(67) = constant rate coefficient
    ! RCONST(68) = constant rate coefficient
    RCONST(69) = (ARR2(1.7D-11,116.0D0))
    ! RCONST(70) = constant rate coefficient
    RCONST(71) = (5.334D-05*SUN)
    RCONST(72) = (ARR2(5.4D-17,-500.0D0))
    ! RCONST(73) = constant rate coefficient
    RCONST(74) = (1.654D-04*SUN)
    ! RCONST(75) = constant rate coefficient
    ! RCONST(76) = constant rate coefficient
    ! RCONST(77) = constant rate coefficient
    ! RCONST(78) = constant rate coefficient
    ! RCONST(79) = constant rate coefficient
    RCONST(80) = (ARR2(1.7D-14,1300.0D0))
    ! RCONST(81) = constant rate coefficient

    END SUBROUTINE Update_RCONST

    SUBROUTINE CBM4_FUN(V,F,RCT,Vdot)
    DOUBLE PRECISION :: V(NVAR),F(NFIX),RCT(NREACT),VDOT(NVAR)
    ! local variables
    DOUBLE PRECISION :: A(NREACT)
    ! Computation of equation rates
    A(1) = RCT(1)*V(26)
    A(2) = RCT(2)*V(29)
    A(3) = RCT(3)*V(25)*V(31)
    A(4) = 9.3D-12*V(26)*V(29)
    A(5) = RCT(5)*V(26)*V(29)
    A(6) = RCT(6)*V(29)*V(31)
    A(7) = RCT(7)*V(25)*V(26)
    A(8) = RCT(8)*V(25)
    A(9) = RCT(9)*V(25)
    A(10) = RCT(10)*V(1)
    A(11) = 2.2D-10*V(1)*F(1)
    A(12) = RCT(12)*V(25)*V(27)
    A(13) = RCT(13)*V(25)*V(28)
    A(14) = RCT(14)*V(30)
    A(15) = RCT(15)*V(30)*V(31)
    A(16) = RCT(16)*V(26)*V(30)
    A(17) = RCT(17)*V(26)*V(30)
    A(18) = 1.3D-21*V(6)*F(1)
    A(19) = RCT(19)*V(6)
    A(20) = RCT(20)*V(31)*V(31)
    A(21) = 4.39999D-40*V(26)*V(31)*F(1)
    A(22) = RCT(22)*V(27)*V(31)
    A(23) = RCT(23)*V(9)
    A(24) = 6.6D-12*V(9)*V(27)
    A(25) = 1D-20*V(9)*V(9)
    A(26) = RCT(26)*V(26)*V(27)
    A(27) = RCT(27)*V(12)*V(27)
    A(28) = RCT(28)*V(28)*V(31)
    A(29) = RCT(29)*V(26)*V(28)
    A(30) = RCT(30)*V(10)
    A(31) = RCT(31)*V(10)*V(27)
    A(32) = RCT(32)*V(28)*V(28)
    A(33) = RCT(33)*V(28)*V(28)*F(1)
    A(34) = RCT(34)*V(2)
    A(35) = RCT(35)*V(2)*V(27)
    A(36) = 2.2D-13*V(16)*V(27)
    A(37) = 1D-11*V(21)*V(27)
    A(38) = RCT(38)*V(21)
    A(39) = RCT(39)*V(21)
    A(40) = RCT(40)*V(21)*V(29)
    A(41) = 6.3D-16*V(21)*V(30)
    A(42) = RCT(42)*V(24)*V(29)
    A(43) = RCT(43)*V(24)*V(27)
    A(44) = 2.5D-15*V(24)*V(30)
    A(45) = RCT(45)*V(24)
    A(46) = RCT(46)*V(31)*V(32)
    A(47) = RCT(47)*V(26)*V(32)
    A(48) = RCT(48)*V(3)
    A(49) = 2D-12*V(32)*V(32)
    A(50) = 6.5D-12*V(28)*V(32)
    A(51) = RCT(51)*V(27)
    A(52) = 8.1D-13*V(20)*V(27)
    A(53) = RCT(53)*V(13)
    A(54) = 1600*V(13)
    A(55) = 1.5D-11*V(13)*V(26)
    A(56) = RCT(56)*V(23)*V(29)
    A(57) = RCT(57)*V(23)*V(27)
    A(58) = RCT(58)*V(23)*V(25)
    A(59) = 7.7D-15*V(23)*V(30)
    A(60) = RCT(60)*V(17)*V(29)
    A(61) = RCT(61)*V(17)*V(27)
    A(62) = RCT(62)*V(17)*V(25)
    A(63) = RCT(63)*V(5)*V(27)
    A(64) = 8.1D-12*V(11)*V(31)
    A(65) = 4.2*V(11)
    A(66) = 4.1D-11*V(14)*V(27)
    A(67) = 2.2D-11*V(14)*V(30)
    A(68) = 1.4D-11*V(4)*V(26)
    A(69) = RCT(69)*V(7)*V(27)
    A(70) = 3D-11*V(19)*V(27)
    A(71) = RCT(71)*V(19)
    A(72) = RCT(72)*V(19)*V(25)
    A(73) = 1.7D-11*V(15)*V(27)
    A(74) = RCT(74)*V(15)
    A(75) = 1.8D-11*V(22)*V(29)
    A(76) = 9.6D-11*V(22)*V(27)
    A(77) = 1.2D-17*V(22)*V(25)
    A(78) = 3.2D-13*V(22)*V(30)
    A(79) = 8.1D-12*V(18)*V(31)
    A(80) = RCT(80)*V(18)*V(18)
    A(81) = 6.8D-13*V(8)*V(31)

    ! Aggregate function
    Vdot(1) = A(9)-A(10)-A(11)
    Vdot(2) = A(32)+A(33)-A(34)-A(35)
    Vdot(3) = A(47)-A(48)
    Vdot(4) = 0.4*A(66)+A(67)-A(68)
    Vdot(5) = -A(63)
    Vdot(6) = A(17)-A(18)-A(19)
    Vdot(7) = -A(69)
    Vdot(8) = 0.13*A(52)+0.04*A(53)+0.02*A(56)+0.09*A(59)+0.13*A(76)+A(78)-A(81)
    Vdot(9) = 2*A(21)+A(22)-A(23)-A(24)-2*A(25)
    Vdot(10) = A(29)-A(30)-A(31)
    Vdot(11) = 0.56*A(63)-A(64)-A(65)+0.3*A(69)
    Vdot(12) = 2*A(18)+A(26)-A(27)+A(41)+A(44)+A(67)
    Vdot(13) = 0.76*A(52)-0.98*A(53)-A(54)-A(55)
    Vdot(14) = 0.36*A(63)+A(65)-A(66)-A(67)+0.2*A(69)
    Vdot(15) = 0.8*A(69)+0.2*A(72)-A(73)-A(74)+0.4*A(76)+0.2*A(77)
    Vdot(16) = -A(36)+A(37)+A(38)+A(39)+A(40)+A(41)+A(45)+0.3*A(56)+0.33*A(58)+A(60)+0.42*A(62)+2*A(70)+A(71)+0.69*A(72)&
               &+A(74)+0.5*A(75)+0.06*A(77)
    Vdot(17) = -A(60)-A(61)-A(62)+0.45*A(75)+A(76)+0.55*A(77)
    Vdot(18) = A(45)+A(46)+2*A(49)+0.79*A(50)+A(51)+0.87*A(52)+0.96*A(53)+0.28*A(56)+A(57)+0.22*A(58)+0.91*A(59)+0.7*A(60)&
               &+A(61)+0.08*A(63)+0.6*A(66)+0.5*A(69)+A(70)+0.03*A(72)+A(73)+0.5*A(75)+A(76)-A(79)-2*A(80)
    Vdot(19) = 0.9*A(64)+0.3*A(66)-A(70)-A(71)-A(72)
    Vdot(20) = -1.11*A(52)-2.1*A(53)+0.22*A(56)-A(57)-A(58)-A(59)+1.1*A(69)+0.9*A(75)+0.1*A(77)
    Vdot(21) = -A(37)-A(38)-A(39)-A(40)-A(41)+A(45)+A(46)+2*A(49)+0.79*A(50)+A(51)+0.2*A(56)+A(57)+0.74*A(58)+A(59)+A(60)&
               &+1.56*A(61)+A(62)+A(70)+0.7*A(72)+A(76)+A(77)
    Vdot(22) = -A(75)-A(76)-A(77)-A(78)
    Vdot(23) = -A(56)-A(57)-A(58)-A(59)+0.55*A(75)
    Vdot(24) = -A(42)-A(43)-A(44)-A(45)+0.11*A(52)+1.1*A(53)+0.63*A(56)+A(57)+0.5*A(58)+A(59)+0.22*A(61)+0.03*A(72)+0.8&
               &*A(75)+0.2*A(76)+0.4*A(77)
    Vdot(25) = A(2)-A(3)-A(7)-A(8)-A(9)-A(12)-A(13)-A(58)-A(62)-A(72)-A(77)
    Vdot(26) = -A(1)+A(3)-A(4)-A(5)+A(6)-A(7)+0.89*A(14)+2*A(15)-A(17)+A(19)+2*A(20)-A(21)+A(24)+A(25)-A(26)+A(28)-A(29)&
               &+A(30)+A(31)+A(46)-A(47)+A(48)-A(55)+A(59)+0.9*A(64)-A(68)+A(79)
    Vdot(27) = 2*A(11)-A(12)+A(13)-A(22)+A(23)-A(24)-A(26)-A(27)+A(28)-A(31)+2*A(34)-A(35)-A(36)-A(37)+A(40)+A(42)-A(43)&
               &+0.79*A(50)-A(51)-A(52)+0.2*A(56)-A(57)+0.1*A(58)+0.3*A(60)-A(61)-A(63)-A(66)-A(69)-A(70)+0.08*A(72)-A(73)&
               &-A(76)+0.1*A(77)
    Vdot(28) = A(12)-A(13)-A(28)-A(29)+A(30)-2*A(32)-2*A(33)+A(35)+A(36)+A(37)+2*A(38)+A(40)+A(41)+2*A(45)+A(46)+2*A(49)&
               &-0.21*A(50)+A(51)+0.11*A(52)+0.94*A(53)+A(54)+0.38*A(56)+A(57)+0.44*A(58)+1.7*A(60)+A(61)+0.12*A(62)+0.44&
               &*A(63)+0.9*A(64)+A(65)+0.6*A(66)+0.7*A(69)+2*A(70)+A(71)+0.76*A(72)+A(74)+0.6*A(75)+0.67*A(76)+0.44*A(77)
    Vdot(29) = A(1)-A(2)-A(4)-A(5)-A(6)+A(8)+A(10)+0.89*A(14)-A(40)-A(42)-A(56)-A(60)-A(75)
    Vdot(30) = A(5)+A(7)-A(14)-A(15)-A(16)-A(17)+A(19)+A(27)-A(41)-A(44)-A(59)-A(67)-A(78)
    Vdot(31) = A(1)-A(3)+A(4)-A(6)+0.11*A(14)-A(15)+A(16)-2*A(20)-A(21)-A(22)+A(23)+A(25)-A(28)-A(46)-A(64)-A(79)-A(81)
    Vdot(32) = A(42)+A(43)+A(44)-A(46)-A(47)+A(48)-2*A(49)-A(50)+A(70)+A(71)+0.62*A(72)+A(73)+A(74)+0.2*A(76)
    END SUBROUTINE CBM4_FUN

    SUBROUTINE CBM4_JAC ( V, F, RCT, JV )

    ! V - Concentrations of variable species (local)
    DOUBLE PRECISION :: V(NVAR)
    ! F - Concentrations of fixed species (local)
    DOUBLE PRECISION :: F(NFIX)
    ! RCT - Rate constants (local)
    DOUBLE PRECISION :: RCT(NREACT)
    ! JV - full Jacobian of variables
    DOUBLE PRECISION :: JV(NVAR,NVAR)


    ! Local variables
    ! B - Temporary array
    DOUBLE PRECISION :: B(138)

    ! B(1) = dA(1)/dV(26)
    B(1) = RCT(1)
    ! B(2) = dA(2)/dV(29)
    B(2) = RCT(2)
    ! B(3) = dA(3)/dV(25)
    B(3) = RCT(3)*V(31)
    ! B(4) = dA(3)/dV(31)
    B(4) = RCT(3)*V(25)
    ! B(5) = dA(4)/dV(26)
    B(5) = 9.3D-12*V(29)
    ! B(6) = dA(4)/dV(29)
    B(6) = 9.3D-12*V(26)
    ! B(7) = dA(5)/dV(26)
    B(7) = RCT(5)*V(29)
    ! B(8) = dA(5)/dV(29)
    B(8) = RCT(5)*V(26)
    ! B(9) = dA(6)/dV(29)
    B(9) = RCT(6)*V(31)
    ! B(10) = dA(6)/dV(31)
    B(10) = RCT(6)*V(29)
    ! B(11) = dA(7)/dV(25)
    B(11) = RCT(7)*V(26)
    ! B(12) = dA(7)/dV(26)
    B(12) = RCT(7)*V(25)
    ! B(13) = dA(8)/dV(25)
    B(13) = RCT(8)
    ! B(14) = dA(9)/dV(25)
    B(14) = RCT(9)
    ! B(15) = dA(10)/dV(1)
    B(15) = RCT(10)
    ! B(16) = dA(11)/dV(1)
    B(16) = 2.2D-10*F(1)
    ! B(18) = dA(12)/dV(25)
    B(18) = RCT(12)*V(27)
    ! B(19) = dA(12)/dV(27)
    B(19) = RCT(12)*V(25)
    ! B(20) = dA(13)/dV(25)
    B(20) = RCT(13)*V(28)
    ! B(21) = dA(13)/dV(28)
    B(21) = RCT(13)*V(25)
    ! B(22) = dA(14)/dV(30)
    B(22) = RCT(14)
    ! B(23) = dA(15)/dV(30)
    B(23) = RCT(15)*V(31)
    ! B(24) = dA(15)/dV(31)
    B(24) = RCT(15)*V(30)
    ! B(25) = dA(16)/dV(26)
    B(25) = RCT(16)*V(30)
    ! B(26) = dA(16)/dV(30)
    B(26) = RCT(16)*V(26)
    ! B(27) = dA(17)/dV(26)
    B(27) = RCT(17)*V(30)
    ! B(28) = dA(17)/dV(30)
    B(28) = RCT(17)*V(26)
    ! B(29) = dA(18)/dV(6)
    B(29) = 1.3D-21*F(1)
    ! B(31) = dA(19)/dV(6)
    B(31) = RCT(19)
    ! B(32) = dA(20)/dV(31)
    B(32) = RCT(20)*2*V(31)
    ! B(33) = dA(21)/dV(26)
    B(33) = 4.39999D-40*V(31)*F(1)
    ! B(34) = dA(21)/dV(31)
    B(34) = 4.39999D-40*V(26)*F(1)
    ! B(36) = dA(22)/dV(27)
    B(36) = RCT(22)*V(31)
    ! B(37) = dA(22)/dV(31)
    B(37) = RCT(22)*V(27)
    ! B(38) = dA(23)/dV(9)
    B(38) = RCT(23)
    ! B(39) = dA(24)/dV(9)
    B(39) = 6.6D-12*V(27)
    ! B(40) = dA(24)/dV(27)
    B(40) = 6.6D-12*V(9)
    ! B(41) = dA(25)/dV(9)
    B(41) = 1D-20*2*V(9)
    ! B(42) = dA(26)/dV(26)
    B(42) = RCT(26)*V(27)
    ! B(43) = dA(26)/dV(27)
    B(43) = RCT(26)*V(26)
    ! B(44) = dA(27)/dV(12)
    B(44) = RCT(27)*V(27)
    ! B(45) = dA(27)/dV(27)
    B(45) = RCT(27)*V(12)
    ! B(46) = dA(28)/dV(28)
    B(46) = RCT(28)*V(31)
    ! B(47) = dA(28)/dV(31)
    B(47) = RCT(28)*V(28)
    ! B(48) = dA(29)/dV(26)
    B(48) = RCT(29)*V(28)
    ! B(49) = dA(29)/dV(28)
    B(49) = RCT(29)*V(26)
    ! B(50) = dA(30)/dV(10)
    B(50) = RCT(30)
    ! B(51) = dA(31)/dV(10)
    B(51) = RCT(31)*V(27)
    ! B(52) = dA(31)/dV(27)
    B(52) = RCT(31)*V(10)
    ! B(53) = dA(32)/dV(28)
    B(53) = RCT(32)*2*V(28)
    ! B(54) = dA(33)/dV(28)
    B(54) = RCT(33)*2*V(28)*F(1)
    ! B(56) = dA(34)/dV(2)
    B(56) = RCT(34)
    ! B(57) = dA(35)/dV(2)
    B(57) = RCT(35)*V(27)
    ! B(58) = dA(35)/dV(27)
    B(58) = RCT(35)*V(2)
    ! B(59) = dA(36)/dV(16)
    B(59) = 2.2D-13*V(27)
    ! B(60) = dA(36)/dV(27)
    B(60) = 2.2D-13*V(16)
    ! B(61) = dA(37)/dV(21)
    B(61) = 1D-11*V(27)
    ! B(62) = dA(37)/dV(27)
    B(62) = 1D-11*V(21)
    ! B(63) = dA(38)/dV(21)
    B(63) = RCT(38)
    ! B(64) = dA(39)/dV(21)
    B(64) = RCT(39)
    ! B(65) = dA(40)/dV(21)
    B(65) = RCT(40)*V(29)
    ! B(66) = dA(40)/dV(29)
    B(66) = RCT(40)*V(21)
    ! B(67) = dA(41)/dV(21)
    B(67) = 6.3D-16*V(30)
    ! B(68) = dA(41)/dV(30)
    B(68) = 6.3D-16*V(21)
    ! B(69) = dA(42)/dV(24)
    B(69) = RCT(42)*V(29)
    ! B(70) = dA(42)/dV(29)
    B(70) = RCT(42)*V(24)
    ! B(71) = dA(43)/dV(24)
    B(71) = RCT(43)*V(27)
    ! B(72) = dA(43)/dV(27)
    B(72) = RCT(43)*V(24)
    ! B(73) = dA(44)/dV(24)
    B(73) = 2.5D-15*V(30)
    ! B(74) = dA(44)/dV(30)
    B(74) = 2.5D-15*V(24)
    ! B(75) = dA(45)/dV(24)
    B(75) = RCT(45)
    ! B(76) = dA(46)/dV(31)
    B(76) = RCT(46)*V(32)
    ! B(77) = dA(46)/dV(32)
    B(77) = RCT(46)*V(31)
    ! B(78) = dA(47)/dV(26)
    B(78) = RCT(47)*V(32)
    ! B(79) = dA(47)/dV(32)
    B(79) = RCT(47)*V(26)
    ! B(80) = dA(48)/dV(3)
    B(80) = RCT(48)
    ! B(81) = dA(49)/dV(32)
    B(81) = 2D-12*2*V(32)
    ! B(82) = dA(50)/dV(28)
    B(82) = 6.5D-12*V(32)
    ! B(83) = dA(50)/dV(32)
    B(83) = 6.5D-12*V(28)
    ! B(84) = dA(51)/dV(27)
    B(84) = RCT(51)
    ! B(85) = dA(52)/dV(20)
    B(85) = 8.1D-13*V(27)
    ! B(86) = dA(52)/dV(27)
    B(86) = 8.1D-13*V(20)
    ! B(87) = dA(53)/dV(13)
    B(87) = RCT(53)
    ! B(88) = dA(54)/dV(13)
    B(88) = 1600
    ! B(89) = dA(55)/dV(13)
    B(89) = 1.5D-11*V(26)
    ! B(90) = dA(55)/dV(26)
    B(90) = 1.5D-11*V(13)
    ! B(91) = dA(56)/dV(23)
    B(91) = RCT(56)*V(29)
    ! B(92) = dA(56)/dV(29)
    B(92) = RCT(56)*V(23)
    ! B(93) = dA(57)/dV(23)
    B(93) = RCT(57)*V(27)
    ! B(94) = dA(57)/dV(27)
    B(94) = RCT(57)*V(23)
    ! B(95) = dA(58)/dV(23)
    B(95) = RCT(58)*V(25)
    ! B(96) = dA(58)/dV(25)
    B(96) = RCT(58)*V(23)
    ! B(97) = dA(59)/dV(23)
    B(97) = 7.7D-15*V(30)
    ! B(98) = dA(59)/dV(30)
    B(98) = 7.7D-15*V(23)
    ! B(99) = dA(60)/dV(17)
    B(99) = RCT(60)*V(29)
    ! B(100) = dA(60)/dV(29)
    B(100) = RCT(60)*V(17)
    ! B(101) = dA(61)/dV(17)
    B(101) = RCT(61)*V(27)
    ! B(102) = dA(61)/dV(27)
    B(102) = RCT(61)*V(17)
    ! B(103) = dA(62)/dV(17)
    B(103) = RCT(62)*V(25)
    ! B(104) = dA(62)/dV(25)
    B(104) = RCT(62)*V(17)
    ! B(105) = dA(63)/dV(5)
    B(105) = RCT(63)*V(27)
    ! B(106) = dA(63)/dV(27)
    B(106) = RCT(63)*V(5)
    ! B(107) = dA(64)/dV(11)
    B(107) = 8.1D-12*V(31)
    ! B(108) = dA(64)/dV(31)
    B(108) = 8.1D-12*V(11)
    ! B(109) = dA(65)/dV(11)
    B(109) = 4.2
    ! B(110) = dA(66)/dV(14)
    B(110) = 4.1D-11*V(27)
    ! B(111) = dA(66)/dV(27)
    B(111) = 4.1D-11*V(14)
    ! B(112) = dA(67)/dV(14)
    B(112) = 2.2D-11*V(30)
    ! B(113) = dA(67)/dV(30)
    B(113) = 2.2D-11*V(14)
    ! B(114) = dA(68)/dV(4)
    B(114) = 1.4D-11*V(26)
    ! B(115) = dA(68)/dV(26)
    B(115) = 1.4D-11*V(4)
    ! B(116) = dA(69)/dV(7)
    B(116) = RCT(69)*V(27)
    ! B(117) = dA(69)/dV(27)
    B(117) = RCT(69)*V(7)
    ! B(118) = dA(70)/dV(19)
    B(118) = 3D-11*V(27)
    ! B(119) = dA(70)/dV(27)
    B(119) = 3D-11*V(19)
    ! B(120) = dA(71)/dV(19)
    B(120) = RCT(71)
    ! B(121) = dA(72)/dV(19)
    B(121) = RCT(72)*V(25)
    ! B(122) = dA(72)/dV(25)
    B(122) = RCT(72)*V(19)
    ! B(123) = dA(73)/dV(15)
    B(123) = 1.7D-11*V(27)
    ! B(124) = dA(73)/dV(27)
    B(124) = 1.7D-11*V(15)
    ! B(125) = dA(74)/dV(15)
    B(125) = RCT(74)
    ! B(126) = dA(75)/dV(22)
    B(126) = 1.8D-11*V(29)
    ! B(127) = dA(75)/dV(29)
    B(127) = 1.8D-11*V(22)
    ! B(128) = dA(76)/dV(22)
    B(128) = 9.6D-11*V(27)
    ! B(129) = dA(76)/dV(27)
    B(129) = 9.6D-11*V(22)
    ! B(130) = dA(77)/dV(22)
    B(130) = 1.2D-17*V(25)
    ! B(131) = dA(77)/dV(25)
    B(131) = 1.2D-17*V(22)
    ! B(132) = dA(78)/dV(22)
    B(132) = 3.2D-13*V(30)
    ! B(133) = dA(78)/dV(30)
    B(133) = 3.2D-13*V(22)
    ! B(134) = dA(79)/dV(18)
    B(134) = 8.1D-12*V(31)
    ! B(135) = dA(79)/dV(31)
    B(135) = 8.1D-12*V(18)
    ! B(136) = dA(80)/dV(18)
    B(136) = RCT(80)*2*V(18)
    ! B(137) = dA(81)/dV(8)
    B(137) = 6.8D-13*V(31)
    ! B(138) = dA(81)/dV(31)
    B(138) = 6.8D-13*V(8)

    ! Construct the Jacobian terms from B's
    JV(1,1)   = -B(15)-B(16)
    JV(1,25)  = B(14)
    JV(2,2)   = -B(56)-B(57)
    JV(2,27)  = -B(58)
    JV(2,28)  = B(53)+B(54)
    JV(3,3)   = -B(80)
    JV(3,26)  = B(78)
    JV(3,32)  = B(79)
    JV(4,4)   = -B(114)
    JV(4,14)  = 0.4*B(110)+B(112)
    JV(4,26)  = -B(115)
    JV(4,27)  = 0.4*B(111)
    JV(4,30)  = B(113)
    JV(5,5)   = -B(105)
    JV(5,27)  = -B(106)
    JV(6,6)   = -B(29)-B(31)
    JV(6,26)  = B(27)
    JV(6,30)  = B(28)
    JV(7,7)   = -B(116)
    JV(7,27)  = -B(117)
    JV(8,8)   = -B(137)
    JV(8,13)  = 0.04*B(87)
    JV(8,20)  = 0.13*B(85)
    JV(8,22)  = 0.13*B(128)+B(132)
    JV(8,23)  = 0.02*B(91)+0.09*B(97)
    JV(8,27)  = 0.13*B(86)+0.13*B(129)
    JV(8,29)  = 0.02*B(92)
    JV(8,30)  = 0.09*B(98)+B(133)
    JV(8,31)  = -B(138)
    JV(9,9)   = -B(38)-B(39)-2*B(41)
    JV(9,26)  = 2*B(33)
    JV(9,27)  = B(36)-B(40)
    JV(9,31)  = 2*B(34)+B(37)
    JV(10,10) = -B(50)-B(51)
    JV(10,26) = B(48)
    JV(10,27) = -B(52)
    JV(10,28) = B(49)
    JV(11,5)  = 0.56*B(105)
    JV(11,7)  = 0.3*B(116)
    JV(11,11) = -B(107)-B(109)
    JV(11,27) = 0.56*B(106)+0.3*B(117)
    JV(11,31) = -B(108)
    JV(12,6)  = 2*B(29)
    JV(12,12) = -B(44)
    JV(12,14) = B(112)
    JV(12,21) = B(67)
    JV(12,24) = B(73)
    JV(12,26) = B(42)
    JV(12,27) = B(43)-B(45)
    JV(12,30) = B(68)+B(74)+B(113)
    JV(13,13) = -0.98*B(87)-B(88)-B(89)
    JV(13,20) = 0.76*B(85)
    JV(13,26) = -B(90)
    JV(13,27) = 0.76*B(86)
    JV(14,5)  = 0.36*B(105)
    JV(14,7)  = 0.2*B(116)
    JV(14,11) = B(109)
    JV(14,14) = -B(110)-B(112)
    JV(14,27) = 0.36*B(106)-B(111)+0.2*B(117)
    JV(14,30) = -B(113)
    JV(15,7)  = 0.8*B(116)
    JV(15,15) = -B(123)-B(125)
    JV(15,19) = 0.2*B(121)
    JV(15,22) = 0.4*B(128)+0.2*B(130)
    JV(15,25) = 0.2*B(122)+0.2*B(131)
    JV(15,27) = 0.8*B(117)-B(124)+0.4*B(129)
    JV(16,15) = B(125)
    JV(16,16) = -B(59)
    JV(16,17) = B(99)+0.42*B(103)
    JV(16,19) = 2*B(118)+B(120)+0.69*B(121)
    JV(16,21) = B(61)+B(63)+B(64)+B(65)+B(67)
    JV(16,22) = 0.5*B(126)+0.06*B(130)
    JV(16,23) = 0.3*B(91)+0.33*B(95)
    JV(16,24) = B(75)
    JV(16,25) = 0.33*B(96)+0.42*B(104)+0.69*B(122)+0.06*B(131)
    JV(16,27) = -B(60)+B(62)+2*B(119)
    JV(16,29) = B(66)+0.3*B(92)+B(100)+0.5*B(127)
    JV(16,30) = B(68)
    JV(17,17) = -B(99)-B(101)-B(103)
    JV(17,22) = 0.45*B(126)+B(128)+0.55*B(130)
    JV(17,25) = -B(104)+0.55*B(131)
    JV(17,27) = -B(102)+B(129)
    JV(17,29) = -B(100)+0.45*B(127)
    JV(18,5)  = 0.08*B(105)
    JV(18,7)  = 0.5*B(116)
    JV(18,13) = 0.96*B(87)
    JV(18,14) = 0.6*B(110)
    JV(18,15) = B(123)
    JV(18,17) = 0.7*B(99)+B(101)
    JV(18,18) = -B(134)-2*B(136)
    JV(18,19) = B(118)+0.03*B(121)
    JV(18,20) = 0.87*B(85)
    JV(18,22) = 0.5*B(126)+B(128)
    JV(18,23) = 0.28*B(91)+B(93)+0.22*B(95)+0.91*B(97)
    JV(18,24) = B(75)
    JV(18,25) = 0.22*B(96)+0.03*B(122)
    JV(18,27) = B(84)+0.87*B(86)+B(94)+B(102)+0.08*B(106)+0.6*B(111)+0.5*B(117)+B(119)+B(124)+B(129)
    JV(18,28) = 0.79*B(82)
    JV(18,29) = 0.28*B(92)+0.7*B(100)+0.5*B(127)
    JV(18,30) = 0.91*B(98)
    JV(18,31) = B(76)-B(135)
    JV(18,32) = B(77)+2*B(81)+0.79*B(83)
    JV(19,11) = 0.9*B(107)
    JV(19,14) = 0.3*B(110)
    JV(19,19) = -B(118)-B(120)-B(121)
    JV(19,25) = -B(122)
    JV(19,27) = 0.3*B(111)-B(119)
    JV(19,31) = 0.9*B(108)
    JV(20,7)  = 1.1*B(116)
    JV(20,13) = -2.1*B(87)
    JV(20,20) = -1.11*B(85)
    JV(20,22) = 0.9*B(126)+0.1*B(130)
    JV(20,23) = 0.22*B(91)-B(93)-B(95)-B(97)
    JV(20,25) = -B(96)+0.1*B(131)
    JV(20,27) = -1.11*B(86)-B(94)+1.1*B(117)
    JV(20,29) = 0.22*B(92)+0.9*B(127)
    JV(20,30) = -B(98)
    JV(21,17) = B(99)+1.56*B(101)+B(103)
    JV(21,19) = B(118)+0.7*B(121)
    JV(21,21) = -B(61)-B(63)-B(64)-B(65)-B(67)
    JV(21,22) = B(128)+B(130)
    JV(21,23) = 0.2*B(91)+B(93)+0.74*B(95)+B(97)
    JV(21,24) = B(75)
    JV(21,25) = 0.74*B(96)+B(104)+0.7*B(122)+B(131)
    JV(21,27) = -B(62)+B(84)+B(94)+1.56*B(102)+B(119)+B(129)
    JV(21,28) = 0.79*B(82)
    JV(21,29) = -B(66)+0.2*B(92)+B(100)
    JV(21,30) = -B(68)+B(98)
    JV(21,31) = B(76)
    JV(21,32) = B(77)+2*B(81)+0.79*B(83)
    JV(22,22) = -B(126)-B(128)-B(130)-B(132)
    JV(22,25) = -B(131)
    JV(22,27) = -B(129)
    JV(22,29) = -B(127)
    JV(22,30) = -B(133)
    JV(23,22) = 0.55*B(126)
    JV(23,23) = -B(91)-B(93)-B(95)-B(97)
    JV(23,25) = -B(96)
    JV(23,27) = -B(94)
    JV(23,29) = -B(92)+0.55*B(127)
    JV(23,30) = -B(98)
    JV(24,13) = 1.1*B(87)
    JV(24,17) = 0.22*B(101)
    JV(24,19) = 0.03*B(121)
    JV(24,20) = 0.11*B(85)
    JV(24,22) = 0.8*B(126)+0.2*B(128)+0.4*B(130)
    JV(24,23) = 0.63*B(91)+B(93)+0.5*B(95)+B(97)
    JV(24,24) = -B(69)-B(71)-B(73)-B(75)
    JV(24,25) = 0.5*B(96)+0.03*B(122)+0.4*B(131)
    JV(24,27) = -B(72)+0.11*B(86)+B(94)+0.22*B(102)+0.2*B(129)
    JV(24,29) = -B(70)+0.63*B(92)+0.8*B(127)
    JV(24,30) = -B(74)+B(98)
    JV(25,17) = -B(103)
    JV(25,19) = -B(121)
    JV(25,22) = -B(130)
    JV(25,23) = -B(95)
    JV(25,25) = -B(3)-B(11)-B(13)-B(14)-B(18)-B(20)-B(96)-B(104)-B(122)-B(131)
    JV(25,26) = -B(12)
    JV(25,27) = -B(19)
    JV(25,28) = -B(21)
    JV(25,29) = B(2)
    JV(25,31) = -B(4)
    JV(26,3)  = B(80)
    JV(26,4)  = -B(114)
    JV(26,6)  = B(31)
    JV(26,9)  = B(39)+B(41)
    JV(26,10) = B(50)+B(51)
    JV(26,11) = 0.9*B(107)
    JV(26,13) = -B(89)
    JV(26,18) = B(134)
    JV(26,23) = B(97)
    JV(26,25) = B(3)-B(11)
    JV(26,26) = -B(1)-B(5)-B(7)-B(12)-B(27)-B(33)-B(42)-B(48)-B(78)-B(90)-B(115)
    JV(26,27) = B(40)-B(43)+B(52)
    JV(26,28) = B(46)-B(49)
    JV(26,29) = -B(6)-B(8)+B(9)
    JV(26,30) = 0.89*B(22)+2*B(23)-B(28)+B(98)
    JV(26,31) = B(4)+B(10)+2*B(24)+2*B(32)-B(34)+B(47)+B(76)+0.9*B(108)+B(135)
    JV(26,32) = B(77)-B(79)
    JV(27,1)  = 2*B(16)
    JV(27,2)  = 2*B(56)-B(57)
    JV(27,5)  = -B(105)
    JV(27,7)  = -B(116)
    JV(27,9)  = B(38)-B(39)
    JV(27,10) = -B(51)
    JV(27,12) = -B(44)
    JV(27,14) = -B(110)
    JV(27,15) = -B(123)
    JV(27,16) = -B(59)
    JV(27,17) = 0.3*B(99)-B(101)
    JV(27,19) = -B(118)+0.08*B(121)
    JV(27,20) = -B(85)
    JV(27,21) = -B(61)+B(65)
    JV(27,22) = -B(128)+0.1*B(130)
    JV(27,23) = 0.2*B(91)-B(93)+0.1*B(95)
    JV(27,24) = B(69)-B(71)
    JV(27,25) = -B(18)+B(20)+0.1*B(96)+0.08*B(122)+0.1*B(131)
    JV(27,26) = -B(42)
    JV(27,27) = -B(19)-B(36)-B(40)-B(43)-B(45)-B(52)-B(58)-B(60)-B(62)-B(72)-B(84)-B(86)-B(94)-B(102)-B(106)-B(111)-B(117)&
                &-B(119)-B(124)-B(129)
    JV(27,28) = B(21)+B(46)+0.79*B(82)
    JV(27,29) = B(66)+B(70)+0.2*B(92)+0.3*B(100)
    JV(27,31) = -B(37)+B(47)
    JV(27,32) = 0.79*B(83)
    JV(28,2)  = B(57)
    JV(28,5)  = 0.44*B(105)
    JV(28,7)  = 0.7*B(116)
    JV(28,10) = B(50)
    JV(28,11) = 0.9*B(107)+B(109)
    JV(28,13) = 0.94*B(87)+B(88)
    JV(28,14) = 0.6*B(110)
    JV(28,15) = B(125)
    JV(28,16) = B(59)
    JV(28,17) = 1.7*B(99)+B(101)+0.12*B(103)
    JV(28,19) = 2*B(118)+B(120)+0.76*B(121)
    JV(28,20) = 0.11*B(85)
    JV(28,21) = B(61)+2*B(63)+B(65)+B(67)
    JV(28,22) = 0.6*B(126)+0.67*B(128)+0.44*B(130)
    JV(28,23) = 0.38*B(91)+B(93)+0.44*B(95)
    JV(28,24) = 2*B(75)
    JV(28,25) = B(18)-B(20)+0.44*B(96)+0.12*B(104)+0.76*B(122)+0.44*B(131)
    JV(28,26) = -B(48)
    JV(28,27) = B(19)+B(58)+B(60)+B(62)+B(84)+0.11*B(86)+B(94)+B(102)+0.44*B(106)+0.6*B(111)+0.7*B(117)+2*B(119)+0.67&
                &*B(129)
    JV(28,28) = -B(21)-B(46)-B(49)-2*B(53)-2*B(54)-0.21*B(82)
    JV(28,29) = B(66)+0.38*B(92)+1.7*B(100)+0.6*B(127)
    JV(28,30) = B(68)
    JV(28,31) = -B(47)+B(76)+0.9*B(108)
    JV(28,32) = B(77)+2*B(81)-0.21*B(83)
    JV(29,1)  = B(15)
    JV(29,17) = -B(99)
    JV(29,21) = -B(65)
    JV(29,22) = -B(126)
    JV(29,23) = -B(91)
    JV(29,24) = -B(69)
    JV(29,25) = B(13)
    JV(29,26) = B(1)-B(5)-B(7)
    JV(29,29) = -B(2)-B(6)-B(8)-B(9)-B(66)-B(70)-B(92)-B(100)-B(127)
    JV(29,30) = 0.89*B(22)
    JV(29,31) = -B(10)
    JV(30,6)  = B(31)
    JV(30,12) = B(44)
    JV(30,14) = -B(112)
    JV(30,21) = -B(67)
    JV(30,22) = -B(132)
    JV(30,23) = -B(97)
    JV(30,24) = -B(73)
    JV(30,25) = B(11)
    JV(30,26) = B(7)+B(12)-B(25)-B(27)
    JV(30,27) = B(45)
    JV(30,29) = B(8)
    JV(30,30) = -B(22)-B(23)-B(26)-B(28)-B(68)-B(74)-B(98)-B(113)-B(133)
    JV(30,31) = -B(24)
    JV(31,8)  = -B(137)
    JV(31,9)  = B(38)+B(41)
    JV(31,11) = -B(107)
    JV(31,18) = -B(134)
    JV(31,25) = -B(3)
    JV(31,26) = B(1)+B(5)+B(25)-B(33)
    JV(31,27) = -B(36)
    JV(31,28) = -B(46)
    JV(31,29) = B(6)-B(9)
    JV(31,30) = 0.11*B(22)-B(23)+B(26)
    JV(31,31) = -B(4)-B(10)-B(24)-2*B(32)-B(34)-B(37)-B(47)-B(76)-B(108)-B(135)-B(138)
    JV(31,32) = -B(77)
    JV(32,3)  = B(80)
    JV(32,15) = B(123)+B(125)
    JV(32,19) = B(118)+B(120)+0.62*B(121)
    JV(32,22) = 0.2*B(128)
    JV(32,24) = B(69)+B(71)+B(73)
    JV(32,25) = 0.62*B(122)
    JV(32,26) = -B(78)
    JV(32,27) = B(72)+B(119)+B(124)+0.2*B(129)
    JV(32,28) = -B(82)
    JV(32,29) = B(70)
    JV(32,30) = B(74)
    JV(32,31) = -B(76)
    JV(32,32) = -B(77)-B(79)-2*B(81)-B(83)
      
    END SUBROUTINE CBM4_JAC

! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
! 
! ReactantProd - Reactant Products in each equation
!   Arguments :
!      V         - Concentrations of variable species (local)
!      F         - Concentrations of fixed species (local)
!      ARP       - Reactant product in each equation
! 
! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

    SUBROUTINE ReactantProd ( V, F, ARP )

    ! V - Concentrations of variable species (local)
    DOUBLE PRECISION :: V(NVAR)
    ! F - Concentrations of fixed species (local)
    DOUBLE PRECISION :: F(NFIX)
    ! ARP - Reactant product in each equation
    DOUBLE PRECISION :: ARP(NREACT)

    ! Reactant Products in each equation are useful in the
    !     stoichiometric formulation of mass action law
    ARP(1) = V(26)
    ARP(2) = V(29)
    ARP(3) = V(25)*V(31)
    ARP(4) = V(26)*V(29)
    ARP(5) = V(26)*V(29)
    ARP(6) = V(29)*V(31)
    ARP(7) = V(25)*V(26)
    ARP(8) = V(25)
    ARP(9) = V(25)
    ARP(10) = V(1)
    ARP(11) = V(1)*F(1)
    ARP(12) = V(25)*V(27)
    ARP(13) = V(25)*V(28)
    ARP(14) = V(30)
    ARP(15) = V(30)*V(31)
    ARP(16) = V(26)*V(30)
    ARP(17) = V(26)*V(30)
    ARP(18) = V(6)*F(1)
    ARP(19) = V(6)
    ARP(20) = V(31)*V(31)
    ARP(21) = V(26)*V(31)*F(1)
    ARP(22) = V(27)*V(31)
    ARP(23) = V(9)
    ARP(24) = V(9)*V(27)
    ARP(25) = V(9)*V(9)
    ARP(26) = V(26)*V(27)
    ARP(27) = V(12)*V(27)
    ARP(28) = V(28)*V(31)
    ARP(29) = V(26)*V(28)
    ARP(30) = V(10)
    ARP(31) = V(10)*V(27)
    ARP(32) = V(28)*V(28)
    ARP(33) = V(28)*V(28)*F(1)
    ARP(34) = V(2)
    ARP(35) = V(2)*V(27)
    ARP(36) = V(16)*V(27)
    ARP(37) = V(21)*V(27)
    ARP(38) = V(21)
    ARP(39) = V(21)
    ARP(40) = V(21)*V(29)
    ARP(41) = V(21)*V(30)
    ARP(42) = V(24)*V(29)
    ARP(43) = V(24)*V(27)
    ARP(44) = V(24)*V(30)
    ARP(45) = V(24)
    ARP(46) = V(31)*V(32)
    ARP(47) = V(26)*V(32)
    ARP(48) = V(3)
    ARP(49) = V(32)*V(32)
    ARP(50) = V(28)*V(32)
    ARP(51) = V(27)
    ARP(52) = V(20)*V(27)
    ARP(53) = V(13)
    ARP(54) = V(13)
    ARP(55) = V(13)*V(26)
    ARP(56) = V(23)*V(29)
    ARP(57) = V(23)*V(27)
    ARP(58) = V(23)*V(25)
    ARP(59) = V(23)*V(30)
    ARP(60) = V(17)*V(29)
    ARP(61) = V(17)*V(27)
    ARP(62) = V(17)*V(25)
    ARP(63) = V(5)*V(27)
    ARP(64) = V(11)*V(31)
    ARP(65) = V(11)
    ARP(66) = V(14)*V(27)
    ARP(67) = V(14)*V(30)
    ARP(68) = V(4)*V(26)
    ARP(69) = V(7)*V(27)
    ARP(70) = V(19)*V(27)
    ARP(71) = V(19)
    ARP(72) = V(19)*V(25)
    ARP(73) = V(15)*V(27)
    ARP(74) = V(15)
    ARP(75) = V(22)*V(29)
    ARP(76) = V(22)*V(27)
    ARP(77) = V(22)*V(25)
    ARP(78) = V(22)*V(30)
    ARP(79) = V(18)*V(31)
    ARP(80) = V(18)*V(18)
    ARP(81) = V(8)*V(31)
      
    END SUBROUTINE ReactantProd

    ! End of ReactantProd function
    ! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


    ! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

    ! Begin Derivative w.r.t. Rate Coefficients

    ! ------------------------------------------------------------------------------
    ! Subroutine for the derivative of Fun with respect to rate coefficients
    ! -----------------------------------------------------------------------------

    SUBROUTINE  dFun_dRcoeff( V, F, NCOEFF, JCOEFF, DFDR )
    IMPLICIT NONE 
    ! V - Concentrations of variable/radical/fixed species            
    DOUBLE PRECISION :: V(NVAR), F(NFIX)
    ! NCOEFF - the number of rate coefficients with respect to which we
    ! differentiate
    INTEGER :: NCOEFF       
    ! JCOEFF - a vector of integers containing the indices of reactions (rate
    !          coefficients) with respect to which we differentiate
    INTEGER :: JCOEFF(NCOEFF)       
    ! DFDR  - a matrix containg derivative values; specifically, 
    !         column j contains d Fun(1:NVAR) / d RCT( JCOEFF(j) )
    !         for each 1 <= j <= NCOEFF
    !         This matrix is stored in a column-wise linearized format
    DOUBLE PRECISION :: DFDR(NVAR,NCOEFF)

    ! Local vector with reactant products
    DOUBLE PRECISION :: A_RPROD(NREACT)
    DOUBLE PRECISION :: aj
    INTEGER :: i,j,k
      
    ! Compute the reactant products of all reactions     
    CALL ReactantProd ( V, F, A_RPROD )

    ! Compute the derivatives by multiplying column JCOEFF(j) of the stoichiometric
    ! matrix with A_RPROD       
      DO j=1,NCOEFF
         ! Initialize the j-th column of derivative matrix to zero       
         DO i=1,NVAR
           DFDR(i,j) = 0.0 
         END DO
         ! Column JCOEFF(j) in the stoichiometric matrix times the
         ! reactant product  of the JCOEFF(j)-th reaction      
         ! give the j-th column of the derivative matrix   
         aj = A_RPROD(JCOEFF(j))
         DO k=CCOL_STOICM(JCOEFF(j)),CCOL_STOICM(JCOEFF(j)+1)-1
           DFDR(IROW_STOICM(k),j) = STOICM(k)*aj
         END DO
      END DO
      
    END SUBROUTINE  dFun_dRcoeff

! End Derivative w.r.t. Rate Coefficients

!~~~> Simplified Arrhenius, with two arguments
!~~~> Note: The argument B0 has a changed sign when compared to ARR
    DOUBLE PRECISION FUNCTION ARR2(A0,B0 )
    DOUBLE PRECISION :: A0,B0
    ARR2 =  DBLE(A0) * EXP( DBLE(B0)/TEMP )
    END FUNCTION ARR2

END MODULE
